<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarchical Graph Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg-primary: #fcfcf9;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f5f5f5;
            --text-primary: #134252;
            --text-secondary: #626c71;
            --border-color: rgba(94, 82, 64, 0.2);
            --accent-color: #208081;
            --accent-hover: #1d7480;
            --accent-active: #1a6873;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1f2121;
                --bg-secondary: #262828;
                --bg-tertiary: #f5f5f5;
                --text-primary: #f5f5f5;
                --text-secondary: rgba(167, 169, 169, 0.7);
                --border-color: rgba(119, 124, 124, 0.3);
                --accent-color: #32b8c6;
                --accent-hover: #2da6b2;
                --accent-active: #1a6873;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        #container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        svg {
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
        }
        
        .node {
            cursor: pointer;
            stroke: var(--bg-primary);
            stroke-width: 2;
            transition: all 0.2s ease;
        }
        
        .node:hover {
            stroke: var(--text-primary);
            filter: brightness(1.1);
        }
        
        .link {
            stroke: var(--text-secondary);
            stroke-opacity: 0.6;
            fill: none;
        }
        
        .link.hierarchical {
            stroke: var(--text-secondary);
            stroke-width: 1.5;
        }
        
        .link.highlighted {
            stroke: var(--accent-color);
            stroke-opacity: 1;
            stroke-width: 2;
        }
        
        .node-label {
            pointer-events: none;
            font-weight: 500;
            text-anchor: middle;
            dominant-baseline: middle;
            paint-order: stroke;
            stroke: var(--bg-primary);
            stroke-width: 3px;
            stroke-linejoin: round;
        }
        
        .boundary-circle {
            fill: none;
            stroke: var(--border-color);
            stroke-dasharray: 5,5;
            opacity: 0.3;
            pointer-events: none;
        }
        
        .tooltip {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1000;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            color: var(--text-primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: none;
            white-space: nowrap;
            transform: translate(-50%, -100%);
            margin-top: -8px;
        }
        
        .tooltip.visible {
            display: block;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            font-size: 12px;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .controls button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
            margin-top: 8px;
            width: 100%;
        }
        
        .controls button:hover {
            background: var(--accent-hover);
        }
        
        .controls button:active {
            background: var(--accent-active);
        }
        
        .info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            font-size: 11px;
            max-width: 250px;
            z-index: 100;
        }
        
        .info-label {
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .info-value {
            color: var(--accent-color);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="container">
        <svg id="graph"></svg>
        <div class="tooltip" id="tooltip"></div>
        <div class="controls">
            <div>
                <button onclick="resetZoom()">Reset View</button>
                <button onclick="toggleLabels()">Toggle Labels</button>
            </div>
        </div>
        <div class="info">
            <div class="info-label">Nodes: <span class="info-value" id="nodeCount">0</span></div>
            <div class="info-label">Levels: <span class="info-value" id="levelCount">0</span></div>
            <div class="info-label" style="margin-top: 8px; font-size: 10px; color: var(--text-secondary);">
                Drag to move • Scroll to zoom • Click node for path highlight
            </div>
        </div>
    </div>

    <script>
        // Data
        const nodesData = [{"id": "node_0", "label": "0", "title": "root", "level": 1, "x": -61.744118525476964, "y": 7.561473711840016e-15}, {"id": "node_1", "label": "1", "title": "layer_1_type_1", "level": 1, "x": 61.744118525476964, "y": 0.0}, {"id": "node_2", "label": "1.1", "title": "layer_2_type_2", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_3", "label": "1.1.1", "title": "layer_3_type_1", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_4", "label": "1.1.2", "title": "layer_3_type_2", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_5", "label": "1.1.3", "title": "layer_3_type_3", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_6", "label": "1.2", "title": "layer_2_type_3", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_7", "label": "1.2.1", "title": "layer_3_type_4", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_8", "label": "1.2.2", "title": "layer_3_type_5", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_9", "label": "1.2.3", "title": "layer_3_type_6", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_10", "label": "1.3", "title": "layer_2_type_4", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_11", "label": "1.3.1", "title": "layer_3_type_7", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_12", "label": "1.3.2", "title": "layer_3_type_8", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_13", "label": "1.3.3", "title": "layer_3_type_9", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_14", "label": "1.4", "title": "layer_2_type_5", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_15", "label": "1.4.1", "title": "layer_3_type_10", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_16", "label": "1.4.2", "title": "layer_3_type_11", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_17", "label": "1.4.3", "title": "layer_3_type_12", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_18", "label": "2", "title": "layer_1_type_2", "level": 1, "x": 61.744118525476964, "y": 0.0}, {"id": "node_19", "label": "2.1", "title": "layer_2_type_6", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_20", "label": "2.1.1", "title": "layer_3_type_13", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_21", "label": "2.1.2", "title": "layer_3_type_14", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_22", "label": "2.1.3", "title": "layer_3_type_15", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_23", "label": "2.2", "title": "layer_2_type_7", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_24", "label": "2.2.1", "title": "layer_3_type_16", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_25", "label": "2.2.2", "title": "layer_3_type_17", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_26", "label": "2.3", "title": "layer_2_type_8", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_27", "label": "2.3.1", "title": "layer_3_type_18", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_28", "label": "2.3.2", "title": "layer_3_type_19", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_29", "label": "2.3.3", "title": "layer_3_type_20", "level": 3, "x": 135.21961957079455, "y": 0.0}, {"id": "node_30", "label": "3", "title": "layer_1_type_3", "level": 1, "x": 61.744118525476964, "y": 0.0}, {"id": "node_31", "label": "3.1", "title": "layer_2_type_9", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_32", "label": "3.2", "title": "layer_2_type_10", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_33", "label": "4", "title": "layer_1_type_4", "level": 1, "x": 61.744118525476964, "y": 0.0}, {"id": "node_34", "label": "4.1", "title": "layer_2_type_11", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_35", "label": "4.2", "title": "layer_2_type_12", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_36", "label": "4.3", "title": "layer_2_type_13", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_37", "label": "4.4", "title": "layer_2_type_14", "level": 2, "x": 104.96500149331082, "y": 0.0}, {"id": "node_38", "label": "4.5", "title": "layer_2_type_15", "level": 2, "x": 104.96500149331082, "y": 0.0}];
        const edgesData = [{"source": "node_1", "target": "node_2", "type": "hierarchical"}, {"source": "node_2", "target": "node_3", "type": "hierarchical"}, {"source": "node_2", "target": "node_4", "type": "hierarchical"}, {"source": "node_2", "target": "node_5", "type": "hierarchical"}, {"source": "node_1", "target": "node_6", "type": "hierarchical"}, {"source": "node_6", "target": "node_7", "type": "hierarchical"}, {"source": "node_6", "target": "node_8", "type": "hierarchical"}, {"source": "node_6", "target": "node_9", "type": "hierarchical"}, {"source": "node_1", "target": "node_10", "type": "hierarchical"}, {"source": "node_10", "target": "node_11", "type": "hierarchical"}, {"source": "node_10", "target": "node_12", "type": "hierarchical"}, {"source": "node_10", "target": "node_13", "type": "hierarchical"}, {"source": "node_1", "target": "node_14", "type": "hierarchical"}, {"source": "node_14", "target": "node_15", "type": "hierarchical"}, {"source": "node_14", "target": "node_16", "type": "hierarchical"}, {"source": "node_14", "target": "node_17", "type": "hierarchical"}, {"source": "node_18", "target": "node_19", "type": "hierarchical"}, {"source": "node_19", "target": "node_20", "type": "hierarchical"}, {"source": "node_19", "target": "node_21", "type": "hierarchical"}, {"source": "node_19", "target": "node_22", "type": "hierarchical"}, {"source": "node_18", "target": "node_23", "type": "hierarchical"}, {"source": "node_23", "target": "node_24", "type": "hierarchical"}, {"source": "node_23", "target": "node_25", "type": "hierarchical"}, {"source": "node_18", "target": "node_26", "type": "hierarchical"}, {"source": "node_26", "target": "node_27", "type": "hierarchical"}, {"source": "node_26", "target": "node_28", "type": "hierarchical"}, {"source": "node_26", "target": "node_29", "type": "hierarchical"}, {"source": "node_30", "target": "node_31", "type": "hierarchical"}, {"source": "node_30", "target": "node_32", "type": "hierarchical"}, {"source": "node_33", "target": "node_34", "type": "hierarchical"}, {"source": "node_33", "target": "node_35", "type": "hierarchical"}, {"source": "node_33", "target": "node_36", "type": "hierarchical"}, {"source": "node_33", "target": "node_37", "type": "hierarchical"}, {"source": "node_33", "target": "node_38", "type": "hierarchical"}];
        
        // State
        let currentLayout = 'hyperbolic';
        let simulation = null;
        let hoveredNode = null;
        let labelsVisible = true;
        
        // D3 selections
        const svg = d3.select('#graph');
        const tooltip = d3.select('#tooltip');
        let mainGroup = null;
        let link = null;
        let node = null;
        let nodeLabels = null;
        
        const WIDTH = window.innerWidth;
        const HEIGHT = window.innerHeight;
        const R_MAX = (Math.min(WIDTH, HEIGHT) / 2 - 50) * 0.9;
        
        // Font size mapping by node level
        const labelFontSizes = {
            0: '16px',  // Root
            1: '13px',  // Level 1
            2: '11px',  // Level 2
            3: '10px',  // Level 3+
        };
        
        function getLabelFontSize(level) {
            return labelFontSizes[level] || labelFontSizes[3];
        }
        
        function initVisualization() {
            // Clear previous
            svg.selectAll('*').remove();
            
            // Setup SVG
            svg.attr('viewBox', [-WIDTH / 2, -HEIGHT / 2, WIDTH, HEIGHT]);
            
            // Create main group for zoom/pan
            mainGroup = svg.append('g');
            
            // Zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on('zoom', (event) => {
                    mainGroup.attr('transform', event.transform);
                    updateTooltip();
                });
            svg.call(zoom);
            
            // Background rect for reset
            mainGroup.append('rect')
                .attr('x', -WIDTH)
                .attr('y', -HEIGHT)
                .attr('width', WIDTH * 2)
                .attr('height', HEIGHT * 2)
                .attr('fill', 'transparent')
                .on('click', () => {
                    tooltip.classed('visible', false);
                });
            
            // Draw boundary circle
            mainGroup.append('circle')
                .attr('r', R_MAX)
                .attr('class', 'boundary-circle');
            
            // Create links
            link = mainGroup.append('g')
                .selectAll('line')
                .data(edgesData)
                .join('line')
                .attr('class', 'link hierarchical')
                .attr('x1', d => {
                    const source = nodesData.find(n => n.id === d.source);
                    return source ? source.x : 0;
                })
                .attr('y1', d => {
                    const source = nodesData.find(n => n.id === d.source);
                    return source ? source.y : 0;
                })
                .attr('x2', d => {
                    const target = nodesData.find(n => n.id === d.target);
                    return target ? target.x : 0;
                })
                .attr('y2', d => {
                    const target = nodesData.find(n => n.id === d.target);
                    return target ? target.y : 0;
                });
            
            // Node radius based on level
            const nodeRadii = {
                0: 12,
                1: 8,
                2: 6,
                default: 5
            };
            
            // Create nodes
            node = mainGroup.append('g')
                .selectAll('circle')
                .data(nodesData)
                .join('circle')
                .attr('class', 'node')
                .attr('r', d => nodeRadii[d.level] || nodeRadii.default)
                .attr('fill', d => {
                    const colorMap = {
                        0: '#8b5cf6',  // Purple
                        1: '#208081',  // Teal
                        2: '#f59e61',  // Orange
                        default: '#a67c52'  // Brown
                    };
                    return colorMap[d.level] || colorMap.default;
                })
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    hoveredNode = d;
                    d3.select(this).attr('stroke', 'var(--text-primary)');
                    tooltip.classed('visible', true)
                        .text(d.title + ' [' + d.label + ']')
                        .style('left', (event.pageX) + 'px')
                        .style('top', (event.pageY) + 'px');
                })
                .on('mouseout', function() {
                    hoveredNode = null;
                    d3.select(this).attr('stroke', 'var(--bg-primary)');
                    tooltip.classed('visible', false);
                })
                .on('click', (event, d) => {
                    event.stopPropagation();
                    highlightPath(d.id);
                });
            
            // Create node labels (PERSISTENT - ALWAYS VISIBLE)
            nodeLabels = mainGroup.append('g')
                .selectAll('text')
                .data(nodesData)
                .join('text')
                .attr('class', 'node-label')
                .attr('x', d => d.x)
                .attr('y', d => d.y)
                .attr('dy', '0.35em')
                .attr('font-size', d => getLabelFontSize(d.level))
                .attr('fill', 'var(--text-primary)')
                .text(d => d.title)
                .style('opacity', labelsVisible ? 1 : 0);
            
            // Update UI
            document.getElementById('nodeCount').textContent = nodesData.length;
            const maxLevel = Math.max(...nodesData.map(n => n.level), 0);
            document.getElementById('levelCount').textContent = maxLevel;
        }
        
        function updateTooltip() {
            if (hoveredNode) {
                tooltip.style('left', event.pageX + 'px')
                    .style('top', event.pageY + 'px');
            }
        }
        
        function highlightPath(nodeId) {
            const path = new Set();
            let current = nodesData.find(n => n.id === nodeId);
            
            while (current) {
                path.add(current.id);
                current = nodesData.find(n => n.id === current.parent);
            }
            
            // Highlight links in path
            link.classed('highlighted', d => {
                return path.has(d.source) && path.has(d.target);
            });
            
            // Highlight nodes in path
            node.attr('opacity', d => {
                return path.has(d.id) ? 1 : 0.3;
            });
            
            // Highlight labels in path
            nodeLabels.attr('opacity', d => {
                return path.has(d.id) ? 1 : 0.3;
            });
        }
        
        function resetZoom() {
            const duration = 750;
            svg.transition()
                .duration(duration)
                .call(d3.zoom().transform, d3.zoomIdentity.translate(WIDTH / 2, HEIGHT / 2));
            tooltip.classed('visible', false);
            
            // Reset highlighting
            link.classed('highlighted', false);
            node.attr('opacity', 1);
            nodeLabels.attr('opacity', labelsVisible ? 1 : 0);
        }
        
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            nodeLabels.transition()
                .duration(300)
                .style('opacity', labelsVisible ? 1 : 0);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // Update visualization on resize if needed
        });
        
        // Initialize on load
        initVisualization();
        resetZoom();
    </script>
</body>
</html>
